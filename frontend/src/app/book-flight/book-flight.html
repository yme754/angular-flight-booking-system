<div class="book-page">
  <div *ngIf="success" class="glass-card text-center">
    <div class="alert-custom alert-success mb-4">
      <img src="https://img.icons8.com/?size=100&id=11695&format=png&color=000000" class="mb-2" alt="check">
      <h4>{{ success }}</h4>
      <p class="mb-0">Your tickets have been sent to your email.</p>
    </div>
    <div class="d-flex justify-content-center gap-3 mt-4">
      <a routerLink="/home" class="btn-outline-purple">Home</a>
      <a routerLink="/bookings" class="btn-outline-purple">View My Bookings</a>
    </div>
  </div>

  <div class="glass-card" *ngIf="!success">
    <h2>Complete Your Booking</h2>
    
    <div *ngIf="error" class="alert-custom alert-danger">
      {{ error }}
    </div>

    <div class="mb-3">
      <label class="form-label-custom">Trip Type</label>
      <div class="input-group-row">
        <div class="icon-box">
          <img src="https://img.icons8.com/ios/50/000000/airplane-take-off.png" class="input-icon" alt="trip">
        </div>
        <select class="form-control-custom" [(ngModel)]="tripType" (change)="calculateTotal()">
          <option value="ONE_WAY">One Way (₹{{ prices.oneWay }})</option>
          <option value="ROUND_TRIP">Round Trip (₹{{ prices.roundTrip }})</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label-custom">Flight Number</label>
        <div class="input-group-row readonly">
          <div class="icon-box">
            <img src="https://img.icons8.com/?size=100&id=86116&format=png&color=000000" class="input-icon" alt="flight">
          </div>
          <input type="text" class="form-control-custom" [(ngModel)]="flightNumber" disabled>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label-custom">Email</label>
        <div class="input-group-row readonly">
          <div class="icon-box">
            <img src="https://img.icons8.com/?size=100&id=12580&format=png&color=000000" class="input-icon" alt="email">
          </div>
          <input type="email" class="form-control-custom" [(ngModel)]="email" disabled>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <label class="form-label-custom">Number of Seats</label>
      <div class="input-group-row">
        <div class="icon-box">
          <img src="https://img.icons8.com/ios/50/000000/conference-call.png" class="input-icon" alt="seats">
        </div>
        <input type="number" class="form-control-custom" [(ngModel)]="seatCount"
               (ngModelChange)="updateSeatCount($event)" min="1" max="6">
      </div>
    </div>

    <div *ngFor="let passenger of passengers; let i = index" class="mb-4 p-3" style="background: #f8f9fa; border-radius: 12px; border: 1px solid #e9ecef;">
      <h5 class="mb-3 text-secondary" style="font-size: 0.95rem; font-weight: 700;">Passenger {{ i+1 }} Details</h5>
      
      <div class="mb-3">
        <label class="form-label-custom">Full Name</label>
        <div class="input-group-row" style="background: white;">
          <div class="icon-box">
            <img src="https://img.icons8.com/ios/50/000000/user.png" class="input-icon" alt="user">
          </div>
          <input type="text" class="form-control-custom" [(ngModel)]="passenger.name" placeholder="Enter full name">
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label-custom">Gender</label>
          <div class="input-group-row" style="background: white;">
            <div class="icon-box">
              <img src="https://img.icons8.com/ios/50/000000/gender.png" class="input-icon" alt="gender">
            </div>
            <select class="form-control-custom" [(ngModel)]="passenger.gender">
              <option value="" disabled selected>Select</option>
              <option value="MALE">Male</option>
              <option value="FEMALE">Female</option>
              <option value="OTHER">Other</option>
            </select>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label-custom">Meal Preference</label>
          <div class="input-group-row" style="background: white;">
            <div class="icon-box">
              <img src="https://img.icons8.com/ios/50/000000/cutlery.png" class="input-icon" alt="meal">
            </div>
            <select class="form-control-custom" [(ngModel)]="passenger.meal">
              <option value="NONE">No Meal</option>
              <option value="VEG">Vegetarian</option>
              <option value="NON_VEG">Non-Veg</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <div class="seat-map-container text-center">
      <h3 class="seat-map-title">Select Seats</h3>
      
      <div class="seat-legend d-flex justify-content-center gap-4 mb-4">
        <div class="d-flex align-items-center gap-2">
          <div class="seat-icon-legend available"></div>
          <span>Available</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="seat-icon-legend selected"></div>
          <span>Selected</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="seat-icon-legend booked"></div>
          <span>Unavailable</span>
        </div>
      </div>

      <div class="plane-body">
        <div *ngFor="let rowNum of seatRows" class="seat-row">
          
          <div class="seat-group-left">
            <button *ngFor="let col of ['A','B','C']" 
                    class="seat-btn"
                    [ngClass]="getSeatStatus(rowNum + col)"
                    [disabled]="getSeatStatus(rowNum + col) === 'booked' || (seatSelections.length >= seatCount && getSeatStatus(rowNum + col) !== 'selected')"
                    (click)="toggleSeat(rowNum + col)">
              {{ rowNum }}{{ col }}
            </button>
          </div>

          <div class="aisle-spacer"></div>

          <div class="seat-group-right">
             <button *ngFor="let col of ['D','E','F']" 
                    class="seat-btn"
                    [ngClass]="getSeatStatus(rowNum + col)"
                    [disabled]="getSeatStatus(rowNum + col) === 'booked' || (seatSelections.length >= seatCount && getSeatStatus(rowNum + col) !== 'selected')"
                    (click)="toggleSeat(rowNum + col)">
               {{ rowNum }}{{ col }}
             </button>
          </div>
        </div>
      </div>

      <div class="seat-footer mt-4 d-flex justify-content-between align-items-center">
        <div class="text-start">
          <small class="text-muted d-block">Selected Seats:</small>
          <strong>{{ seatSelections.join(', ') || 'None' }}</strong>
        </div>
        <div class="text-end">
          <small class="text-muted d-block">Total Price:</small>
          <strong class="text-primary fs-5">₹{{ totalAmount }}</strong>
        </div>
      </div>
    </div>

    <button class="btn-confirm mt-4" (click)="confirmBooking()" [disabled]="!isFormValid">
      Confirm Selection
    </button>
    
    <div class="text-center mt-3">
        <a routerLink="/search" class="btn-back">Cancel</a>
    </div>
  </div>
</div>