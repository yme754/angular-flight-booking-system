<div class="login-page">
  <div class="glass-card">
    <h2>Welcome Back</h2>
    <p class="subtitle">Please login to your account</p>

    <div *ngIf="isLoggedIn" class="alert-custom alert-success mb-4 text-center">
      You are already logged in as <strong>{{ roles }}</strong>.
    </div>

    <form *ngIf="!isLoggedIn" name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
      
      <div class="alert-custom alert-danger mb-3 text-center" *ngIf="f.submitted && isLoginFailed && !isPasswordExpired">
        {{ errorMessage }}
      </div>

      <div class="alert-custom alert-warning mb-4 text-center" *ngIf="isPasswordExpired" style="background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: 15px; border-radius: 5px;">
        <p class="mb-2"><strong>Password Expired</strong></p>
        <p class="mb-3" style="font-size: 0.9rem;">{{ errorMessage }}</p>
        <button type="button" class="btn btn-sm btn-dark w-100" style="background: #333; color: #fff; padding: 8px;" (click)="navigateToReset()">
          Reset Password Now
        </button>
      </div>

      <div class="mb-4">
        <label class="form-label-custom">Username</label>
        <div class="input-group-row">
          <div class="icon-box">
            <img src="https://img.icons8.com/ios/50/000000/user.png" class="input-icon" alt="user">
          </div>
          <input
            type="text"
            class="form-control-custom"
            name="username"
            [(ngModel)]="form.username"
            required
            placeholder="Enter username"
            #username="ngModel"
          />
        </div>
      </div>

      <div class="mb-2"> <label class="form-label-custom">Password</label>
        <div class="input-group-row" style="position: relative;">
          <div class="icon-box">
            <img src="https://img.icons8.com/ios/50/000000/lock.png" class="input-icon" alt="lock">
          </div>
          <input 
            [type]="showPassword ? 'text' : 'password'"
            class="form-control-custom"
            name="password"
            [(ngModel)]="form.password"
            required
            minlength="12"
            placeholder="••••••••"
            #password="ngModel"
            style="padding-right: 40px;"
          />
          <img 
            [src]="showPassword ? 'https://img.icons8.com/ios/50/000000/visible--v1.png' : 'https://img.icons8.com/ios/50/000000/hide.png'" 
            class="password-toggle" 
            (click)="togglePassword()" 
            alt="Toggle Password"
          >
        </div>
      </div>

      <div class="mb-4" style="text-align: right;">
        <a routerLink="/forgot-password" class="forgot-link">Forgot Password?</a>
      </div>

      <button class="btn-login">Login</button>
      
      <p class="register-link">
        Don't have an account? <a routerLink="/register">Sign Up</a>
      </p>
    </form>
  </div>
</div>